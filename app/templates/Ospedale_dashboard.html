<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Ospedale - BloodChain</title>
  <link rel="stylesheet" href="static/css/Stile.css">
    <style>
    .dashboard1 {
      display: flex;
      gap: 20px;
    }
    .actions {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .buttons_verticali {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    .buttons_verticali button {
  margin: 10px 0;
  width: 80%;
  min-width: 200px;
  max-width: 100%;
  align-self: center;
  font-size: 1.1em;
  padding: 12px;
  border-radius: 8px;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
    .side-panel {
      flex: 1;
      padding: 20px;
      background: #f9f9f9;
      border-left: 2px solid #ccc;
      overflow-y: auto;
      display: none;
    }
    .side-panel.active {
      display: block;
    }
    .form-section {
      margin-bottom: 40px;
      display: none;
    }
    .form-section.active {
      display: block;
    }
    .form-section form {
      display: flex;
      flex-direction: column;
    }
    .form-section label,
    .form-section input,
    .form-section select,
    .form-section button {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>BloodChain</h1>
    <nav><a href="/">Logout</a></nav>
  </header>

  <main class="dashboard1">
    <section class="actions" id="azioni">
      <h2>Azioni Rapide</h2>
      <div class="buttons_verticali">
        <button onclick="showForm('aggiungiSacca')">‚ûï Aggiungi sacca</button> <br>
        <button onclick="showForm('richiediSangue')">ü©∏ Richiedi sangue</button> <br>
        <button onclick="showForm('aggiornaStato')">üîÑ Aggiorna stato</button> <br>
        <button onclick="showForm('aggiungiEmoteca')">üè• Aggiungi Emoteca/SPOC</button> <br>
        <button onclick="showForm('caricaDocumentazione')">üìÉ Carica Documentazione</button> <br>
        <button onclick="showForm('reimpostaDonatore')">üßë‚Äçü¶∞ Reimposta Donatore</button> <br>
      </div>
    </section>

    <aside class="side-panel">
      <div class="form-section" id="aggiungiSacca">
        <h3>Aggiungi nuova sacca</h3>
        <form method="POST" action="/inserisci_sacca">
          <label>ID Sacca:</label>
          <input type="text" name="sacca_id" required>
          <label>Tipo:</label>
          <select name="tipo" required>
            <option value="">-- Seleziona --</option>
            <option value="I">Intera</option>
            <option value="Pl">Plasma</option>
            <option value="Pia">Piastrine</option>
          </select>
          <label>Quantit√† (ml):</label>
          <input type="number" name="quantita" required>
          <label>Codice Fiscale Donatore:</label>
          <input type="text" name="donatore" pattern="^[a-zA-Z]{6}[0-9]{2}[a-zA-Z][0-9]{2}[a-zA-Z][0-9]{3}[a-zA-Z]$" required>
          <label>Gruppo Sanguigno:</label>
          <select name="gruppo_sanguigno" required>
            <option>0+</option><option>0-</option><option>A+</option><option>A-</option>
            <option>B+</option><option>B-</option><option>AB+</option><option>AB-</option>
          </select>
          <label>Data Inserimento:</label>
          <input type="date" name="data_inserimento" required>
          <label>Test associati (separati da virgola):</label>
          <input type="text" name="test">
          <label>Info / Stato sacca:</label>
          <input type="text" name="info">
          <button type="submit">Invia alla Blockchain</button>
        </form>
      </div>

      <div class="form-section" id="richiediSangue">
        <h3>Richiedi transito di sangue</h3>
        <form method="POST" action="/richiedi_transito">
          <label>Da (Ospedale mittente):</label>
          <input type="text" name="da" required>
          <label>A (Ospedale destinatario):</label>
          <input type="text" name="a" required>
          <label>ID Sacche (separate da virgola):</label>
          <input type="text" name="carico" required>
          <button type="submit">Avvia transito</button>
        </form>
      </div>

      <div class="form-section" id="aggiornaStato">
        <h3>Aggiorna stato sacca</h3>
        <form method="POST" action="/aggiorna_stato">
          <label for="chiaveSacca">Chiave della sacca:</label>
          <input type="text" id="chiaveSacca" name="chiave_sacca" required>

          <label for="stato">Nuovo stato:</label>
          <select id="stato" name="stato" required>
            <option value="">-- Seleziona --</option>
            <option value="fruibile">Fruibile</option>
            <option value="non_fruibile">Non fruibile</option>
          </select>

          <button type="submit">Invia</button>
        </form>
      </div>
      
      <div class="form-section" id="aggiungiEmoteca">
        <h3>Aggiungi Emoteca/SPOC</h3>
        <form method="POST" action="/aggiungi_emoteca">
          <label>Nome emoteca:</label>
          <input type="text" name="nome" required>
          <label>Latitudine:</label>
          <input type="text" name="latitudine" required>
          <label>Longitudine:</label>
          <input type="text" name="longitudine" required>
          <label>ID sacche associate:</label>
          <input type="text" name="sacche">
          <button type="submit">Crea Emoteca</button>
        </form>
      </div>

      <div class="form-section" id="caricaDocumentazione">
        <h3>Carica Documentazione</h3>
        <form method="POST" enctype="multipart/form-data" action="/caricaDocumentazione">
          <label>Esito:</label>
          <select name="esito" required>
            <option>Positivo</option>
            <option>Negativo</option>
          </select>
          <label>Documento:</label>
          <input type="file" name="document" required>
          <label><small>Nome file: CodiceFiscale-Data-NomeTest.pdf</small></label>
          <button type="submit">Carica</button>
        </form>
      </div>

      <div class="form-section" id="reimpostaDonatore">
        <h3>Registrazione Donatore</h3>
        <form method="POST" action="/resetDonatore">
          <label>Codice Fiscale:</label>
          <input type="text" name="codice_fiscale" required pattern="^[A-Z]{6}[0-9]{2}[A-Z][0-9]{2}[A-Z][0-9]{3}[A-Z]$">
          <button type="submit">Registrati</button>
        </form> 
        <div id="msgRegistrazione" style="display:none; margin-top:20px; font-weight:bold;">
          Grazie per esserti registrato! Messaggio personalizzato qui.
        </div>       
      </div>
    </aside>
  </main>

  <footer>
    <p>&copy; 2025 BloodChain - Sistema gestione ospedali</p>
  </footer>

  <script>
    function showForm(id) {
      // Mostra il pannello laterale se nascosto
      const panel = document.querySelector('.side-panel');
      if (panel) {
        panel.classList.add('active');
      }
  
      // Nascondi tutte le sezioni dei form
      document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
      });
  
      // Mostra solo il form selezionato
      const el = document.getElementById(id);
      if (el) {
        el.classList.add('active');
      }
    }
  
    // Sfondi dinamici
    const sfondi = ['sfondo.png', 'sfondo2.png', 'sfondo3.png', 'sfondo4.png'];
    const randomIndex = Math.floor(Math.random() * sfondi.length);
    document.body.style.background = `url('${sfondi[randomIndex]}') no-repeat center center fixed`;
    document.body.style.backgroundSize = 'cover';
  </script>

{% if esito %}
  <section style="padding: 20px; background: #e7ffe7; border: 1px solid #6c6; margin-bottom: 20px;">
    <h3>Messaggio:</h3>
    <p>{{ esito }}</p>
  </section>
{% endif %}

{% if blockchain_result %}
  <section style="padding: 20px; background: #e7ffe7; border: 1px solid #6c6;">
    <h3>Risposta dalla Blockchain:</h3>
    <pre>{{ blockchain_result | tojson(indent=2) }}</pre>
  </section>
{% endif %}



</body>
</html>
